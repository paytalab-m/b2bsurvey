<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'sans-serif'],
          },
          colors: { 
            brand: '#ff7949', 
            brandLight: '#fff1ec',
            brandDark: '#132d48', 
            grayBg: '#F7F8FA', 
            inputBg: '#F2F4F6',
            error: '#FF4B4B' 
          },
          boxShadow: {
            'btn': '0 8px 20px -4px rgba(255, 121, 73, 0.4)',
            'card': '0 4px 20px rgba(0, 0, 0, 0.04)',
            'select': '0 0 0 2px #ff7949',
          },
          animation: {
            'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
            'fade-in': 'fadeIn 0.3s ease-out forwards',
          },
          keyframes: {
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            }
          }
        }
      }
    }
  </script>

  <style>
    html, body {
      overscroll-behavior-y: none;
      touch-action: pan-y;
      height: 100%;
      background-color: #ffffff;
      -webkit-tap-highlight-color: transparent;
    }
    .safe-area-padding {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }
    .radio-card:has(input:checked) {
      border-color: #ff7949;
      background-color: #fff1ec;
      color: #ff7949;
      font-weight: 700;
    }
    .radio-card:has(input:checked) .check-icon {
      background-color: #ff7949;
      border-color: #ff7949;
    }
    .radio-card:has(input:checked) .check-icon svg {
      display: block;
    }
  </style>
  <title>ì„¤ë¬¸ì¡°ì‚¬</title>
</head>

<body class="bg-white text-gray-900 font-sans flex flex-col min-h-[100dvh]">

  <div class="fixed top-0 left-0 w-full h-1 bg-gray-100 z-50">
    <div id="progress-bar" class="h-full bg-brand w-[20%] rounded-r-full transition-all duration-500"></div>
  </div>

  <div class="w-full flex-1 flex flex-col safe-area-padding max-w-[480px] mx-auto relative">
    
    <div id="form-container" class="flex-1 px-6 pt-12 pb-10 flex flex-col">
        
        <header class="mb-8 text-center flex flex-col items-center">
            <div class="inline-flex items-center gap-1.5 bg-gray-100 text-gray-500 px-3 py-1 rounded-full mb-4">
                <span class="text-[12px] font-bold tracking-tight">ì„¤ë¬¸ ì¡°ì‚¬</span>
            </div>
            
            <h1 class="text-[24px] font-bold text-[#191F28] leading-[1.3] tracking-tight break-keep">
                ì‚¬ì¥ë‹˜(ì§ì›)ê»˜ <span class="text-brand">QR ì½”ë“œ</span>ë¥¼<br>
                ë³´ì—¬ë“œë¦¬ëŠ” ë° ì„±ê³µí•˜ì…¨ë‚˜ìš”?
            </h1>
            <p class="text-gray-400 text-[15px] mt-2 leading-snug">
                ì†”ì§í•˜ê²Œ ì•Œë ¤ì£¼ì‹œë©´ ë‹¤ìŒ ì´ë²¤íŠ¸ ì¤€ë¹„ì—<br>í° ë„ì›€ì´ ë©ë‹ˆë‹¤.
            </p>
        </header>

        <form id="survey-form" class="flex flex-col flex-1">
            <input type="hidden" name="submissionId" id="submissionId">
            <input type="hidden" name="reason" id="finalReasonInput">
            <input type="hidden" name="storeName" id="storeNameInput">
            
            <div id="step1-section" class="flex flex-col gap-3 animate-slide-up">
                <label class="cursor-pointer group">
                    <input type="radio" name="isShow" value="ë„¤" class="peer hidden" onchange="handleStep1('Y')">
                    <div class="w-full p-5 rounded-2xl border border-gray-200 bg-white shadow-sm transition-all peer-checked:border-brand peer-checked:bg-brandLight peer-checked:shadow-select flex items-center justify-between">
                        <span class="text-[17px] font-medium text-gray-700 peer-checked:text-brand peer-checked:font-bold">ë„¤, ë³´ì—¬ë“œë ¸ì–´ìš” ğŸ™†â€â™‚ï¸</span>
                        <div class="w-5 h-5 rounded-full border border-gray-300 peer-checked:border-brand peer-checked:bg-brand flex items-center justify-center">
                            <svg class="w-3 h-3 text-white hidden peer-checked:block" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                </label>

                <label class="cursor-pointer group">
                    <input type="radio" name="isShow" value="ì•„ë‹ˆìš”" class="peer hidden" onchange="handleStep1('N')">
                    <div class="w-full p-5 rounded-2xl border border-gray-200 bg-white shadow-sm transition-all peer-checked:border-brand peer-checked:bg-brandLight peer-checked:shadow-select flex items-center justify-between">
                        <span class="text-[17px] font-medium text-gray-700 peer-checked:text-brand peer-checked:font-bold">ì•„ë‹ˆìš”, ëª» ë³´ì—¬ë“œë ¸ì–´ìš” ğŸ™…</span>
                        <div class="w-5 h-5 rounded-full border border-gray-300 peer-checked:border-brand peer-checked:bg-brand flex items-center justify-center">
                            <svg class="w-3 h-3 text-white hidden peer-checked:block" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                </label>

                <label class="cursor-pointer group">
                    <input type="radio" name="isShow" value="ì´ë²¤íŠ¸ ì°¸ì—¬ ë°©ë²•ì„ ì •í™•íˆ ëª¨ë¥´ê² ì–´ìš”" class="peer hidden" onchange="handleStep1('DK')">
                    <div class="w-full p-5 rounded-2xl border border-gray-200 bg-white shadow-sm transition-all peer-checked:border-brand peer-checked:bg-brandLight peer-checked:shadow-select flex items-center justify-between">
                        <span class="text-[17px] font-medium text-gray-700 peer-checked:text-brand peer-checked:font-bold">ì°¸ì—¬ ë°©ë²•ì„ ì´í•´í•˜ì§€ ëª» í–ˆì–´ìš” ğŸ˜­</span>
                        <div class="w-5 h-5 rounded-full border border-gray-300 peer-checked:border-brand peer-checked:bg-brand flex items-center justify-center">
                            <svg class="w-3 h-3 text-white hidden peer-checked:block" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                </label>
            </div>

            <div id="step2-container" class="mt-8 hidden opacity-0 transition-opacity duration-500">
                <h2 id="step2-title" class="text-[18px] font-bold text-gray-800 mb-4 animate-slide-up"></h2>
                <div id="step2-options" class="flex flex-col gap-3 animate-slide-up" style="animation-delay: 0.1s;"></div>

                <div id="etc-input-wrapper" class="hidden mt-3 animate-fade-in">
                    <input type="text" name="etcReason" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" class="w-full bg-inputBg border-transparent px-5 h-[3.5rem] rounded-xl text-[16px] outline-none placeholder-gray-400 focus:ring-2 focus:ring-brand focus:bg-white transition-all">
                </div>
            </div>

            <div id="step3-container" class="mt-8 hidden opacity-0 transition-opacity duration-500 border-t border-dashed border-gray-200 pt-8">
                <div class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full inline-block text-[12px] font-bold mb-3 animate-slide-up">
                    ì¶”ê°€ ì§ˆë¬¸
                </div>
                <h2 class="text-[18px] font-bold text-gray-800 mb-4 animate-slide-up">
                    ë‹¤ë¥¸ ë§¤ì¥ì—ì„œë„ ì°¸ì—¬í•  ìˆ˜ ìˆë‹¤ë©´,<br>ë˜ ì°¸ì—¬í•˜ì‹œê² ì–´ìš”?
                </h2>
                
                <div class="flex flex-col gap-3 animate-slide-up" style="animation-delay: 0.1s;">
                    <label class="radio-card cursor-pointer group">
                        <input type="radio" name="rePart" value="ë„¤, ë¬´ì¡°ê±´ í• ë˜ìš”" class="peer hidden" onchange="handleStep3()">
                        <div class="w-full p-4 rounded-xl border border-gray-200 bg-white shadow-card transition-all flex items-center justify-between hover:bg-gray-50">
                            <span class="text-[16px] text-gray-600">ë„¤, ë¬´ì¡°ê±´ í• ë˜ìš”</span>
                            <div class="check-icon w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center transition-colors">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                        </div>
                    </label>

                    <label class="radio-card cursor-pointer group">
                        <input type="radio" name="rePart" value="ì•„ë‹ˆìš”, í•œ ë²ˆìœ¼ë¡œ ì¶©ë¶„í•´ìš”" class="peer hidden" onchange="handleStep3()">
                        <div class="w-full p-4 rounded-xl border border-gray-200 bg-white shadow-card transition-all flex items-center justify-between hover:bg-gray-50">
                            <span class="text-[16px] text-gray-600">ì•„ë‹ˆìš”, í•œ ë²ˆìœ¼ë¡œ ì¶©ë¶„í•´ìš”</span>
                            <div class="check-icon w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center transition-colors">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="mt-auto pt-8">
                <button type="submit" id="submit-btn" disabled class="w-full bg-gray-300 text-white h-[3.75rem] rounded-2xl text-[17px] font-bold shadow-none transition-all flex justify-center items-center gap-2">
                    ì œì¶œí•˜ê¸°
                </button>
            </div>
        </form>
    </div>

    <div id="success-view" class="hidden flex-col justify-center items-center w-full h-full fixed top-0 left-0 bg-white z-[100] px-6 safe-area-padding">
        <div class="mb-6 animate-slide-up">
            <div class="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto">
                <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"></path>
                </svg>
            </div>
        </div>
        <h2 class="text-[#191F28] font-bold text-[24px] leading-tight mb-3 text-center animate-slide-up" style="animation-delay: 0.1s;">
            ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤!
        </h2>
        <p class="text-[#8B95A1] text-[16px] leading-relaxed text-center animate-slide-up" style="animation-delay: 0.2s;">
            ë³´ë‚´ì£¼ì‹  ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ<br>ë” ì¢‹ì€ ì´ë²¤íŠ¸ë¥¼ ì¤€ë¹„í• ê²Œìš”.
        </p>
    </div>

  </div>

  <script>
    /* =========================================
       â˜… [ì„¤ì •] ì œê³µí•´ì£¼ì‹  êµ¬ê¸€ ì‹œíŠ¸ ì›¹ ì•± URL ì ìš©
       ========================================= */
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwC57kFpzrJftiLPtu7H8EzrI-vBAZjRSPxiyOZnPz618AV5DEDhY9BmeMUJiMijfxx/exec";
    const ETC_KEY = 'ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)';

    const optionsYes = [
        { val: 'ì‚¬ì¥ë‹˜ì´ QRì½”ë“œ ì´¬ì˜ì„ ê±°ì ˆí•˜ì…¨ì–´ìš”', text: 'ì‚¬ì¥ë‹˜ì´ QRì½”ë“œ ì´¬ì˜ì„ ê±°ì ˆí•˜ì…¨ì–´ìš”' },
        { val: 'ì§ì›ë¶„ì´ QRì½”ë“œ ì´¬ì˜ì„ ê±°ì ˆí•˜ì…¨ì–´ìš”', text: 'ì§ì›ë¶„ì´ QRì½”ë“œ ì´¬ì˜ì„ ê±°ì ˆí•˜ì…¨ì–´ìš”' },
        { val: 'QRì½”ë“œ ì¸ì‹ì´ ì˜ ì•ˆëì–´ìš”', text: 'QRì½”ë“œ ì¸ì‹ì´ ì˜ ì•ˆëì–´ìš”' },
        { val: ETC_KEY, text: ETC_KEY }
    ];

    const optionsNo = [
        { val: 'ë§¤ì¥ì´ ë„ˆë¬´ ë°”ë¹ ì„œ ë³´ì—¬ë“œë¦¬ì§€ ëª»í–ˆì–´ìš”', text: 'ë§¤ì¥ì´ ë„ˆë¬´ ë°”ë¹ ì„œ ë³´ì—¬ë“œë¦¬ì§€ ëª»í–ˆì–´ìš”' }, 
        { val: 'ì‚¬ì¥ë‹˜ê»˜ ë§ ê±¸ê¸°ê°€ ë„ˆë¬´ ì–´ìƒ‰í–ˆì–´ìš”', text: 'ì‚¬ì¥ë‹˜ê»˜ ë§ ê±¸ê¸°ê°€ ë„ˆë¬´ ì–´ìƒ‰í–ˆì–´ìš”' },
        { val: 'ë§¤ì¥ì´ ë©€ê±°ë‚˜ ë°©ë¬¸í•  ì‹œê°„ì´ ì—†ì—ˆì–´ìš”', text: 'ë§¤ì¥ì´ ë©€ê±°ë‚˜ ë°©ë¬¸í•  ì‹œê°„ì´ ì—†ì—ˆì–´ìš”' },
        { val: 'ì°¸ì—¬ í˜œíƒì´ ë¶€ì¡±í•´ì„œ ì•ˆ í–ˆì–´ìš”', text: 'ì°¸ì—¬ í˜œíƒì´ ë¶€ì¡±í•´ì„œ ì•ˆ í–ˆì–´ìš”' },
        { val: 'ë§¤ì¥ì´ ë‹«í˜€ ìˆì—ˆì–´ìš”', text: 'ë§¤ì¥ì´ ë‹«í˜€ ìˆì—ˆì–´ìš”' }, 
        { val: ETC_KEY, text: ETC_KEY }
    ];

    const optionsDontKnow = [
        { val: 'ì°¸ì—¬í•˜ëŠ” ë°©ë²•ì„ ì§ê´€ì ìœ¼ë¡œ ì•Œ ìˆ˜ ì—†ì—ˆì–´ìš”', text: 'ì°¸ì—¬í•˜ëŠ” ë°©ë²•ì„ ì§ê´€ì ìœ¼ë¡œ ì•Œ ìˆ˜ ì—†ì—ˆì–´ìš”' },
        { val: 'ë³´ì—¬ì¤˜ì•¼ í•  QRì½”ë“œê°€ ì–´ë”” ìˆëŠ”ì§€ ëª» ì°¾ì•˜ì–´ìš”', text: 'ë³´ì—¬ì¤˜ì•¼ í•  QRì½”ë“œê°€ ì–´ë”” ìˆëŠ”ì§€ ëª» ì°¾ì•˜ì–´ìš”' },
        { val: 'ì„¤ëª… ë©”ì‹œì§€ê°€ ë„ˆë¬´ ê¸¸ê³  ì–´ë ¤ì› ì–´ìš”', text: 'ì„¤ëª… ë©”ì‹œì§€ê°€ ë„ˆë¬´ ê¸¸ê³  ì–´ë ¤ì› ì–´ìš”' },
        { val: ETC_KEY, text: ETC_KEY }
    ];

    const progressBar = document.getElementById('progress-bar');
    const step2Container = document.getElementById('step2-container');
    const step2Title = document.getElementById('step2-title');
    const step2Options = document.getElementById('step2-options');
    const etcInputWrapper = document.getElementById('etc-input-wrapper');
    const step3Container = document.getElementById('step3-container');
    const submitBtn = document.getElementById('submit-btn');
    const finalReasonInput = document.getElementById('finalReasonInput');
    const storeNameInput = document.getElementById('storeNameInput'); // â˜… ì¶”ê°€ë¨
    
    let currentFlow = ''; // Y / N / DK

    document.getElementById('submissionId').value = 'SUR-' + Date.now();

    // â˜… URLì—ì„œ ?store=ë§¤ì¥ëª… ì½ì–´ì˜¤ëŠ” ì½”ë“œ
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const store = urlParams.get('store');
        if(store) {
            storeNameInput.value = store;
            console.log("ë§¤ì¥ëª… ê°ì§€ë¨: " + store);
        }
    };

    function handleStep1(answer) {
        currentFlow = answer;
        progressBar.style.width = "40%";
        
        // UI ì´ˆê¸°í™”
        step2Container.classList.remove('hidden');
        step3Container.classList.add('hidden');
        step3Container.classList.remove('opacity-0');
        document.querySelectorAll('input[name="rePart"]').forEach(el => el.checked = false);

        setTimeout(() => {
            step2Container.classList.remove('opacity-0');
            step2Container.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 10);

        step2Options.innerHTML = '';
        etcInputWrapper.classList.add('hidden');
        submitBtn.disabled = true;
        updateSubmitBtn(false);
        finalReasonInput.value = ""; // ì´ˆê¸°í™”

        let targetOptions, titleText, inputType;
        
        if (answer === 'Y') {
            targetOptions = optionsYes;
            titleText = 'ë³´ì—¬ë“œë ¸ëŠ”ë°, ê²°ê³¼ëŠ” ì–´ë• ë‚˜ìš”?';
            inputType = 'radio';
        } else if (answer === 'N') {
            targetOptions = optionsNo;
            titleText = 'ì•„ì‰¬ì›Œìš”! ê°€ì¥ í° ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”? (ì¤‘ë³µ ê°€ëŠ¥)';
            inputType = 'checkbox';
        } else { // DK
            targetOptions = optionsDontKnow;
            titleText = 'ì£„ì†¡í•´ìš”! ê°€ì¥ í—·ê°ˆë ¸ë˜ ì ì€ ë¬´ì—‡ì¸ê°€ìš”? (ì¤‘ë³µ ê°€ëŠ¥)';
            inputType = 'checkbox';
        }
        
        step2Title.innerText = titleText;

        targetOptions.forEach(opt => {
            const label = document.createElement('label');
            label.className = "radio-card cursor-pointer group";
            label.innerHTML = `
                <input type="${inputType}" name="selectionOption" value="${opt.val}" class="peer hidden" onchange="handleOptionChange()">
                <div class="w-full p-4 rounded-xl border border-gray-200 bg-white shadow-card transition-all flex items-center justify-between hover:bg-gray-50">
                    <span class="text-[16px] text-gray-600">${opt.text}</span>
                    <div class="check-icon w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center transition-colors">
                        <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                </div>
            `;
            step2Options.appendChild(label);
        });
    }

    // ì²´í¬ë°•ìŠ¤/ë¼ë””ì˜¤ ë³€ê²½ ì‹œ ì²˜ë¦¬ (í†µí•©)
    function handleOptionChange() {
        const checkedInputs = document.querySelectorAll('input[name="selectionOption"]:checked');
        const values = Array.from(checkedInputs).map(input => input.value);
        
        finalReasonInput.value = values.join(', ');

        if (values.includes(ETC_KEY)) {
            etcInputWrapper.classList.remove('hidden');
        } else {
            etcInputWrapper.classList.add('hidden');
        }

        if (currentFlow === 'Y') {
            if (values.length > 0) {
                progressBar.style.width = "70%";
                step3Container.classList.remove('hidden');
                setTimeout(() => {
                    step3Container.classList.remove('opacity-0');
                    step3Container.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 10);
                updateSubmitBtn(false); 
            }
        } else {
            if (values.length > 0) {
                progressBar.style.width = "90%";
                updateSubmitBtn(true);
                step3Container.classList.add('hidden');
            } else {
                updateSubmitBtn(false); 
            }
        }
    }

    function handleStep3() {
        progressBar.style.width = "90%";
        updateSubmitBtn(true);
    }

    function updateSubmitBtn(isActive) {
        if(isActive) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('bg-gray-300', 'shadow-none');
            submitBtn.classList.add('bg-brand', 'shadow-btn', 'active:scale-[0.98]');
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.add('bg-gray-300', 'shadow-none');
            submitBtn.classList.remove('bg-brand', 'shadow-btn', 'active:scale-[0.98]');
        }
    }

    document.getElementById('survey-form').addEventListener('submit', function(e) {
        e.preventDefault();
        submitBtn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ì œì¶œ ì¤‘...`;
        progressBar.style.width = "100%";

        const formData = new FormData(this);
        fetch(GAS_WEB_APP_URL, { 
             method: 'POST', 
             body: formData, 
             mode: 'no-cors' 
        })
        .then(() => showSuccess())
        .catch(() => showSuccess());
    });

    function showSuccess() {
        document.getElementById('success-view').classList.remove('hidden');
        document.getElementById('success-view').classList.add('flex');
    }
  </script>
</body>
</html>
