<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'sans-serif'],
          },
          colors: { 
            brand: '#ff7949', 
            brandLight: '#fff1ec',
            brandDark: '#132d48', 
            grayBg: '#F7F8FA', 
            inputBg: '#F2F4F6',
            error: '#FF4B4B' 
          },
          boxShadow: {
            'btn': '0 8px 20px -4px rgba(255, 121, 73, 0.4)',
            'card': '0 4px 20px rgba(0, 0, 0, 0.04)',
            'select': '0 0 0 2px #ff7949',
          },
          animation: {
            'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
            'fade-in': 'fadeIn 0.3s ease-out forwards',
          },
          keyframes: {
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            }
          }
        }
      }
    }
  </script>

  <style>
    html, body {
      overscroll-behavior-y: none;
      touch-action: pan-y;
      height: 100%;
      background-color: #ffffff;
      -webkit-tap-highlight-color: transparent;
    }
    .safe-area-padding {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }
    .radio-card:has(input:checked) {
      border-color: #ff7949;
      background-color: #fff1ec;
      color: #ff7949;
      font-weight: 700;
    }
    .radio-card:has(input:checked) .check-icon {
      background-color: #ff7949;
      border-color: #ff7949;
    }
    .radio-card:has(input:checked) .check-icon svg {
      display: block;
    }
  </style>
  <title>설문조사</title>
</head>

<body class="bg-white text-gray-900 font-sans flex flex-col min-h-[100dvh]">

  <div class="fixed top-0 left-0 w-full h-1 bg-gray-100 z-50">
    <div id="progress-bar" class="h-full bg-brand w-[20%] rounded-r-full transition-all duration-500"></div>
  </div>

  <div class="w-full flex-1 flex flex-col safe-area-padding max-w-[480px] mx-auto relative">
    
    <div id="form-container" class="flex-1 px-6 pt-12 pb-10 flex flex-col">
        
        <header class="mb-8 text-center flex flex-col items-center">
            <div class="inline-flex items-center gap-1.5 bg-gray-100 text-gray-500 px-3 py-1 rounded-full mb-4">
                <span class="text-[12px] font-bold tracking-tight">설문 조사</span>
            </div>
            
            <h1 class="text-[24px] font-bold text-[#191F28] leading-[1.3] tracking-tight break-keep">
                사장님(직원)께 <span class="text-brand">QR 코드</span>를<br>
                보여드리는 데 성공하셨나요?
            </h1>
            <p class="text-gray-400 text-[15px] mt-2 leading-snug">
                솔직하게 알려주시면 다음 이벤트 준비에<br>큰 도움이 됩니다.
            </p>
        </header>

        <form id="survey-form" class="flex flex-col flex-1">
            <input type="hidden" name="submissionId" id="submissionId">
            
            <div id="step1-section" class="flex flex-col gap-3 animate-slide-up">
                <label class="cursor-pointer group">
                    <input type="radio" name="isShow" value="네" class="peer hidden" onchange="handleStep1('Y')">
                    <div class="w-full p-5 rounded-2xl border border-gray-200 bg-white shadow-sm transition-all peer-checked:border-brand peer-checked:bg-brandLight peer-checked:shadow-select flex items-center justify-between">
                        <span class="text-[17px] font-medium text-gray-700 peer-checked:text-brand peer-checked:font-bold">네, 보여드렸어요</span>
                        <div class="w-5 h-5 rounded-full border border-gray-300 peer-checked:border-brand peer-checked:bg-brand flex items-center justify-center">
                            <svg class="w-3 h-3 text-white hidden peer-checked:block" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                </label>

                <label class="cursor-pointer group">
                    <input type="radio" name="isShow" value="아니요" class="peer hidden" onchange="handleStep1('N')">
                    <div class="w-full p-5 rounded-2xl border border-gray-200 bg-white shadow-sm transition-all peer-checked:border-brand peer-checked:bg-brandLight peer-checked:shadow-select flex items-center justify-between">
                        <span class="text-[17px] font-medium text-gray-700 peer-checked:text-brand peer-checked:font-bold">아니요, 못 보여드렸어요</span>
                        <div class="w-5 h-5 rounded-full border border-gray-300 peer-checked:border-brand peer-checked:bg-brand flex items-center justify-center">
                            <svg class="w-3 h-3 text-white hidden peer-checked:block" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                </label>

                <label class="cursor-pointer group">
                    <input type="radio" name="isShow" value="이벤트 참여 방법을 정확히 모르겠어요" class="peer hidden" onchange="handleStep1('DK')">
                    <div class="w-full p-5 rounded-2xl border border-gray-200 bg-white shadow-sm transition-all peer-checked:border-brand peer-checked:bg-brandLight peer-checked:shadow-select flex items-center justify-between">
                        <span class="text-[17px] font-medium text-gray-700 peer-checked:text-brand peer-checked:font-bold">이벤트 참여 방법을 정확히 모르겠어요</span>
                        <div class="w-5 h-5 rounded-full border border-gray-300 peer-checked:border-brand peer-checked:bg-brand flex items-center justify-center">
                            <svg class="w-3 h-3 text-white hidden peer-checked:block" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                </label>
            </div>

            <div id="step2-container" class="mt-8 hidden opacity-0 transition-opacity duration-500">
                <h2 id="step2-title" class="text-[18px] font-bold text-gray-800 mb-4 animate-slide-up"></h2>
                <div id="step2-options" class="flex flex-col gap-3 animate-slide-up" style="animation-delay: 0.1s;"></div>

                <div id="etc-input-wrapper" class="hidden mt-3 animate-fade-in">
                    <input type="text" name="etcReason" placeholder="내용을 입력해주세요" class="w-full bg-inputBg border-transparent px-5 h-[3.5rem] rounded-xl text-[16px] outline-none placeholder-gray-400 focus:ring-2 focus:ring-brand focus:bg-white transition-all">
                </div>
            </div>

            <div id="step3-container" class="mt-8 hidden opacity-0 transition-opacity duration-500 border-t border-dashed border-gray-200 pt-8">
                <div class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full inline-block text-[12px] font-bold mb-3 animate-slide-up">
                    추가 질문
                </div>
                <h2 class="text-[18px] font-bold text-gray-800 mb-4 animate-slide-up">
                    다른 매장에서도 이 이벤트가 있다면,<br>또 참여하시겠어요?
                </h2>
                
                <div class="flex flex-col gap-3 animate-slide-up" style="animation-delay: 0.1s;">
                    <label class="radio-card cursor-pointer group">
                        <input type="radio" name="rePart" value="네, 무조건 할래요" class="peer hidden" onchange="handleStep3()">
                        <div class="w-full p-4 rounded-xl border border-gray-200 bg-white shadow-card transition-all flex items-center justify-between hover:bg-gray-50">
                            <span class="text-[16px] text-gray-600">네, 무조건 할래요</span>
                            <div class="check-icon w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center transition-colors">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                        </div>
                    </label>

                    <label class="radio-card cursor-pointer group">
                        <input type="radio" name="rePart" value="아니요, 한 번으로 충분해요" class="peer hidden" onchange="handleStep3()">
                        <div class="w-full p-4 rounded-xl border border-gray-200 bg-white shadow-card transition-all flex items-center justify-between hover:bg-gray-50">
                            <span class="text-[16px] text-gray-600">아니요, 한 번으로 충분해요</span>
                            <div class="check-icon w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center transition-colors">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="mt-auto pt-8">
                <button type="submit" id="submit-btn" disabled class="w-full bg-gray-300 text-white h-[3.75rem] rounded-2xl text-[17px] font-bold shadow-none transition-all flex justify-center items-center gap-2">
                    제출하기
                </button>
            </div>
        </form>
    </div>

    <div id="success-view" class="hidden flex-col justify-center items-center w-full h-full fixed top-0 left-0 bg-white z-[100] px-6 safe-area-padding">
        <div class="mb-6 animate-slide-up">
            <div class="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto">
                <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"></path>
                </svg>
            </div>
        </div>
        <h2 class="text-[#191F28] font-bold text-[24px] leading-tight mb-3 text-center animate-slide-up" style="animation-delay: 0.1s;">
            소중한 의견 감사합니다!
        </h2>
        <p class="text-[#8B95A1] text-[16px] leading-relaxed text-center animate-slide-up" style="animation-delay: 0.2s;">
            보내주신 내용을 바탕으로<br>더 좋은 이벤트를 준비할게요.
        </p>
    </div>

  </div>

  <script>
    /* =========================================
       ★ [설정] 제공해주신 구글 시트 웹 앱 URL 적용
       ========================================= */
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwC57kFpzrJftiLPtu7H8EzrI-vBAZjRSPxiyOZnPz618AV5DEDhY9BmeMUJiMijfxx/exec";
    const ETC_KEY = '기타 (직접 입력)';

    // Track A: 네, 보여드렸어요
    const optionsYes = [
        { val: '사장님이 QR코드 촬영을 거절하셨어요', text: '사장님이 QR코드 촬영을 거절하셨어요' },
        { val: '직원분이라 권한이 없대요', text: '직원분이라 권한이 없대요' },
        { val: 'QR 인식이 잘 안됐어요', text: 'QR 인식이 잘 안됐어요' },
        { val: ETC_KEY, text: ETC_KEY }
    ];

    // Track B: 아니요, 못 보여드렸어요
    const optionsNo = [
        { val: '매장이 너무 바빠서 말을 못 걸었어요', text: '매장이 너무 바빠서 말을 못 걸었어요' }, 
        { val: '사장님께 말 걸기가 너무 어색해요', text: '사장님께 말 걸기가 너무 어색해요' },
        { val: '매장이 멀거나 방문할 시간이 없었어요', text: '매장이 멀거나 방문할 시간이 없었어요' },
        { val: '혜택이 작아서 안 했어요', text: '혜택이 작아서 안 했어요' },
        { val: '매장이 닫혀 있었어요', text: '매장이 닫혀 있었어요' }, 
        { val: ETC_KEY, text: ETC_KEY }
    ];

    // Track C: 방법을 모르겠어요
    const optionsDontKnow = [
        { val: '사장님께 뭐라고 말해야 할지 모르겠어요', text: '사장님께 뭐라고 말해야 할지 모르겠어요' },
        { val: '보여줘야 할 QR코드가 어디 있는지 못 찾았어요', text: '보여줘야 할 QR코드가 어디 있는지 못 찾았어요' },
        { val: '나와 사장님이 어떤 혜택을 받는지 헷갈렸어요', text: '나와 사장님이 어떤 혜택을 받는지 헷갈렸어요' },
        { val: '설명 메시지가 너무 길고 어려웠어요', text: '설명 메시지가 너무 길고 어려웠어요' },
        { val: ETC_KEY, text: ETC_KEY }
    ];

    const progressBar = document.getElementById('progress-bar');
    const step2Container = document.getElementById('step2-container');
    const step2Title = document.getElementById('step2-title');
    const step2Options = document.getElementById('step2-options');
    const etcInputWrapper = document.getElementById('etc-input-wrapper');
    const step3Container = document.getElementById('step3-container');
    const submitBtn = document.getElementById('submit-btn');
    
    let currentFlow = ''; // Y / N / DK

    document.getElementById('submissionId').value = 'SUR-' + Date.now();

    function handleStep1(answer) {
        currentFlow = answer;
        progressBar.style.width = "40%";
        
        // UI 초기화
        step2Container.classList.remove('hidden');
        step3Container.classList.add('hidden'); // 일단 숨김
        step3Container.classList.remove('opacity-0');
        document.querySelectorAll('input[name="rePart"]').forEach(el => el.checked = false);

        setTimeout(() => {
            step2Container.classList.remove('opacity-0');
            step2Container.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 10);

        step2Options.innerHTML = '';
        etcInputWrapper.classList.add('hidden');
        submitBtn.disabled = true;
        updateSubmitBtn(false);

        // 옵션 및 타이틀 세팅
        let targetOptions, titleText;
        
        if (answer === 'Y') {
            targetOptions = optionsYes;
            titleText = '보여드렸는데, 결과는 어땠나요?';
        } else if (answer === 'N') {
            targetOptions = optionsNo;
            titleText = '아쉬워요! 가장 큰 이유는 무엇인가요?';
        } else { // DK
            targetOptions = optionsDontKnow;
            titleText = '죄송해요! 가장 헷갈렸던 점은 무엇인가요?';
        }
        
        step2Title.innerText = titleText;

        // 라디오 버튼 생성
        targetOptions.forEach(opt => {
            const label = document.createElement('label');
            label.className = "radio-card cursor-pointer group";
            label.innerHTML = `
                <input type="radio" name="reason" value="${opt.val}" class="peer hidden" onchange="handleStep2(this.value)">
                <div class="w-full p-4 rounded-xl border border-gray-200 bg-white shadow-card transition-all flex items-center justify-between hover:bg-gray-50">
                    <span class="text-[16px] text-gray-600">${opt.text}</span>
                    <div class="check-icon w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center transition-colors">
                        <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                </div>
            `;
            step2Options.appendChild(label);
        });
    }

    function handleStep2(value) {
        if(value === ETC_KEY) {
            etcInputWrapper.classList.remove('hidden');
        } else {
            etcInputWrapper.classList.add('hidden');
        }

        if (currentFlow === 'Y') {
            // Track A: Step 3(재참여) 노출
            progressBar.style.width = "70%";
            step3Container.classList.remove('hidden');
            setTimeout(() => {
                step3Container.classList.remove('opacity-0');
                step3Container.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 10);
            updateSubmitBtn(false); // 아직 제출 불가
        } else {
            // Track B, C: 여기서 끝
            progressBar.style.width = "90%";
            updateSubmitBtn(true);
            step3Container.classList.add('hidden');
        }
    }

    function handleStep3() {
        // Track A의 마지막
        progressBar.style.width = "90%";
        updateSubmitBtn(true);
    }

    function updateSubmitBtn(isActive) {
        if(isActive) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('bg-gray-300', 'shadow-none');
            submitBtn.classList.add('bg-brand', 'shadow-btn', 'active:scale-[0.98]');
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.add('bg-gray-300', 'shadow-none');
            submitBtn.classList.remove('bg-brand', 'shadow-btn', 'active:scale-[0.98]');
        }
    }

    document.getElementById('survey-form').addEventListener('submit', function(e) {
        e.preventDefault();
        submitBtn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> 제출 중...`;
        progressBar.style.width = "100%";

        const formData = new FormData(this);
        fetch(GAS_WEB_APP_URL, { 
             method: 'POST', 
             body: formData, 
             mode: 'no-cors' 
        })
        .then(() => showSuccess())
        .catch(() => showSuccess());
    });

    function showSuccess() {
        document.getElementById('success-view').classList.remove('hidden');
        document.getElementById('success-view').classList.add('flex');
    }
  </script>
</body>
</html>
